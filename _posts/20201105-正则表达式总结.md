---
title: 正则表达式总结
date: 2020-11-05 13:00:00
---

### 正则功能

* 校验数据有效性，如校验手机号、邮箱
* 查找符合要求的文本内容，如查找文本中的手机号
* 对文本进行切割、替换等操作，如将日期替换为其他格式

### 元字符

| 字符		| 描述  				|
| :----		| :----  			|
| 特殊单字符 	| --------			|
| .    		| 任意字符（换行除外）	|
| \d  		| 任意数字           	|
| \D  		| 任意非数字         	|
| \w  		| 任意字母数字下划线 	|
| \W  		| 任意非字母数字下划线	|
| \s  		| 任意空白符 			|
| \S  		| 任意非空白符 		|
| 空白符 	| --------			|
| \r  		| 回车符           	|
| \n  		| 换行符         	|
| \f  		| 换页符 			|
| \t  		| 制表符				|
| \v  		| 垂直制表符 			|
| \s  		| 任意空白符 			|
| 量词 		| --------			|
| *  		| 0到多次           	|
| +  		| 1到多次         	|
| ？  		| 0到1次 			|
| \{m}  	| m次				|
| \{m,} 	| 至少m次			|
| \{m,n} 	| m到n次 			|
| 范围 		| --------			|
| \|  		| 或           		|
| […]  		| 多选一         	|
| [a-z] 	| a到z之间任意单一元素	|
| [^…]  	| 取反				|

### 三种正则模式

* 影响量词的匹配行为

| 模式					| 描述										| 正则 			| 文本 	| 结果 	|
| :----					| :----										| :---- 		| :---- | :---- |
| 贪婪模式（Greedy）  	| 默认，最长匹配，匹配不上会吐出已匹配的再尝试 	| a\{1,3}ab 	| aaab 	| 匹配 	|
| 非贪婪模式（Lazy）  	| 后面加？，最短匹配，匹配不上会匹配更长再接着匹配	| a\{1,3}?ab 	| aaab 	| 匹配 	|
| 独占模式（Possessive）	| 后面加+，最长匹配，匹配不上即失败，不会发生回溯	| a\{1,3}+ab 	| aaab 	| 不匹配 |

### 分组

* 量词后加?是非贪婪模式，如果要表示0或1次，需要加括号，如\w{2}(\d{2})?表示后面2位数字有或无
* 括号用于分组，被括号括起来的部分“子表达式”会被保存成一个子组，如 (正式表达式)
* 不保存分组，括号里面加上?:，如 (?:正式表达式)
* 分组编号，数左括号是第几个就是第几个分组（扣除不保存的分组）
* 命名分组，(?P<分组名>正则表达式)
* 分组引用，“反斜扛 + 编号”，即 \number 的方式来进行引用，如 (\w+) \1

### 匹配模式

* 改变元字符匹配行为
* 不区分大小写
	- (?i)
	- 修饰符如果在括号内，作用范围是这个括号内的正则，而不是整个正则
* 点号通配模式（单行匹配模式）
	- (?s)
	- 让点号匹配上包括换行的任何字符，相当于可以匹配多行文本
	- 等价于 [\d\D]或[\w\W]或[\s\S]
* 多行匹配模式
	- (?m)
	- 通常情况下，^匹配整个字符串的开头，$匹配整个字符串的结尾
	- 多行匹配模式改变的就是 ^ 和 $ 的匹配行为，使 ^ 和 $ 能匹配上每行的开头或结尾
	- sublime text默认支持
* 注释模式
	- (?#comment)
	- (\w+)(?#word) \1(?#word repeat again)

### 断言

* 只用于匹配位置，而不是文本内容本身
* 单词边界
	- \b
	- 匹配完整单词，\b\w+\b
* 行开始/结束
	- ^ 和 $
* 环视
	- 匹配完整单词，(?<!\w)\w+(?!\w)
	- 环视中虽然也有括号，但不会保存成子组

| 类型			| 正则		| 描述 				|
| :----			| :----		| :---- 			|
| 肯定逆向环视 	| (?<=Y)X	| 匹配左边是Y的X 		|
| 否定逆向环视 	| (?<!Y)X	| 匹配左边不是Y的X 	|
| 肯定顺序环视 	| X(?=Y)	| 匹配右边是Y的X 		|
| 否定顺序环视 	| X(?!Y)	| 匹配右边不是Y的X 	|

### 转义

* 前面加反斜杠
* \\\d，表示反斜杠后面紧跟着一个字母d
* \\\\|d 或 [\\\d]，表示反斜杠或字母d
* [] {} 只需转义开括号，()两个都需要转义
* 字符组中需要转义的有三种情况
	- 脱字符在中括号中，且在第一个位置
	- 中划线在中括号中，且不在首尾位置
	- 右括号在中括号中，且不在首位
* 注意代码里面会经历2层转义：字符串转义和正则转义

### 流派

* POSIX流派
	- BRE标准
	- ERE标准
* PCRE 流派

### 匹配原理

* 有穷状态自动机
	- 有穷状态是指一个系统具有有穷个状态，不同的状态代表不同的意义
	- 自动机是指系统可以根据相应的条件，在不同的状态下进行转移
	- 从一个初始状态，根据对应的操作执行状态转移，最终达到终止状态（可能有一到多个终止状态）

* 正则引擎
	- 有穷自动机的具体实现
	- 主要有 DFA 和 NFA 两种，其中 NFA 又分为传统的 NFA 和 POSIX NFA
	- DFA 确定性有穷自动机
	- NFA 非确定性有穷自动机
	- 每个状态都需要特定的输入，才能发生状态变化，这就是确定性

* 匹配过程
	- 编译就是生成自动机的过程
	- 这个网站[Regexper](https://regexper.com/)可以显示自动机的图示
	- NFA 先看正则，再看文本，以正则为主导，会发生回溯，字符串同一部分可能会对比很多次
	- DFA 先看文本，再看正则，以文本为主导，整个匹配过程字符串只看一遍，不回溯，相同字符不会测试两次
